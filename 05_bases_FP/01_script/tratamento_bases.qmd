---
title: "Bases para Pesquisa em Ciências Sociais"
format: html
editor: visual
---

## Objetivo

O objetivo deste documento é publicizar os procedimentos de tratamento de uma bases de dados construída a partir de múltiplas fontes, sendo elas:

-   [Tempo de abertura de empresa](https://www.receita.fazenda.df.gov.br/)

Além de criar e disponibilizar a base tratada, disponibilizamos todos os procedimentos executados para chegar nela, conforme o script abaixo.

Preparando o ambiente do R com os pacotes que precisaremos. Caso não tenha instalado o pacote ainda, use a função `install.packages("pacote")`

```{r}
#| warning: false

#install.packages("tidyverse")

library(dplyr)
library(readxl)
library(readr)
library(stringi)
```

## Carregamento e tratamento de dados

### 1) Dados de violência

Os dados de homicídio foram extraídos do Atlas da Violência do IPEA.

1)  padronizamos a variável código do município para o formato texto
2)  pegamos apenas o último ano disponível (2019)
3)  a base de homicídios tinha registros duplicados. Por isso, usamos a função `distinct`
4)  retiramos o dígito verificador do código IBGE, pois algumas bases não utilizam o 7º dígito

```{r}
#| warning: false

homicidios <- read_delim("00_bases/homicidios.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

homicidios$cod <- as.character(homicidios$cod)

homicidios_2019 <- homicidios %>% 
                  filter(período == 2019) %>% 
                  distinct(cod, nome, período, valor) %>% 
                  mutate(cod = substr(cod, 1, 6))

DT::datatable(homicidios_2019)

```

## SEBRAE

Aqui estamos tratando a base do SEBRAE, pois ela não possui um código de identificação de município (ex.: código IBGE)

```{r}
#| warning: false

hierarquia_municipios <- read_csv("00_bases/hierarquia_municipios.csv")
sebrae <- read_excel("00_bases/sebrae.xlsx")

sebrae$Municipio_pad = stri_trans_general(str = sebrae$Município,
                                          id = "Latin-ASCII")

sebrae_hieraquia <- sebrae %>%
                        left_join(hierarquia_municipios,
                                  by = c("Municipio_pad"="municipio_pad",
                                         "UF"="uf_sigla")) %>%
                        select(cod_municipio, cod_municipiodv,
                               municipio, Tipo, CEP, Endereço)

```


# Autoria

Adaleny Paiva, Henrique Silveira e Daniel Pagotto

Como citar Paiva, A.D.S; Pagotto, D. P. Bases para pesquisas em ciências sociais.
